<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üèí Roosan veikkaukset ‚Äì Kevyt</title>

  <!-- PWA / ikonit -->
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="/roosa/manifest.json">
  <link rel="icon" href="/roosa/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/roosa/icons/apple-touch-icon.png">

  <style>
    :root{
      --bg:#f7f7fb; --card:#fff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --btn:#f97316; --btn-hover:#ea580c; 
      --info:#0ea5e9;
      --green:#22c55e; --green-hover:#16a34a;
      --red:#ef4444; --red-hover:#dc2626;
    }

    [data-theme="dark"]{
      --bg:#0b1020; --card:#111727; --text:#e5e7eb; --muted:#9aa3b2; --border:#243047;
      --btn:#fb8a3c; --btn-hover:#ec6f17;
      --info:#38bdf8;
      --green:#4ade80; --green-hover:#22c55e;
      --red:#f87171; --red-hover:#ef4444;
    }

    *{ box-sizing:border-box }
    html,body{ margin:0; padding:0 }
    body{
      background:var(--bg); color:var(--text);
      font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif;
      line-height:1.45; padding:12px;
      transition:background 0.3s ease, color 0.3s ease;
    }

    h1{ 
      text-align:center; margin:0 0 10px; font-size:20px;
      opacity:0; transform:translateY(-8px);
      animation:fadeDown 0.4s ease forwards;
    }

    @keyframes fadeDown{
      to { opacity:1; transform:translateY(0); }
    }

    .topbar{
      display:flex; justify-content:flex-end; align-items:center;
      gap:8px; max-width:520px; margin:0 auto 8px;
    }

    .toggle{
      background:transparent; border:1px solid var(--border);
      color:var(--text); padding:6px 10px; border-radius:999px;
      cursor:pointer; font-weight:700; transition:0.25s;
    }

    .toggle:hover{
      background:var(--border);
    }

    .card{
      background:var(--card); border:1px solid var(--border); border-radius:12px;
      padding:10px; max-width:520px; margin:0 auto;
      animation:fadeIn 0.5s ease;
    }

    @keyframes fadeIn{
      from{ opacity:0; transform:translateY(10px); }
      to{ opacity:1; transform:translateY(0); }
    }

    .person-title{ 
      font-weight:800; margin-bottom:8px; font-size:16px; text-align:center;
      animation:fadeDown 0.4s ease forwards;
    }

    .kv{ display:grid; grid-template-columns:1fr; gap:6px }
    .kv-row{
      display:grid; grid-template-columns:120px 1fr; gap:8px; align-items:center;
      opacity:0; transform:translateY(6px);
      animation:fadeRow 0.25s ease forwards;
    }

    @keyframes fadeRow{
      to{ opacity:1; transform:translateY(0); }
    }

    .kv-label{ font-weight:600; font-size:13px }
    input,select{
      width:100%; padding:9px 10px; border:1px solid var(--border);
      border-radius:10px; font-size:16px; background:#fff; color:#111;
      transition:background 0.25s, color 0.25s, border 0.25s;
    }

    [data-theme="dark"] input,
    [data-theme="dark"] select{
      background:#0f1525; color:#e5e7eb; border-color:#2a3651;
    }

    .score-combo,.time-combo{ display:flex; align-items:center; gap:6px }
    .score-combo input,.time-combo input{ width:56px; text-align:center }
    .dash,.colon{ font-weight:800 }

    /* ‚úÖ Korjattu nappirivi */
    .row-end{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin-top:10px;
      flex-wrap:wrap;
      width:100%;
    }

    .btn{
      border:none; border-radius:10px;
      padding:10px 12px; font-weight:700; cursor:pointer;
      transition:0.2s;
    }

    .btn-green{
      background:var(--green); color:#fff;
    }
    .btn-green:hover{ background:var(--green-hover); }

    .btn-red{
      background:var(--red); color:#fff;
    }
    .btn-red:hover{ background:var(--red-hover); }

    .muted{ 
      color:var(--muted); font-size:12px; text-align:center; margin-top:8px;
      animation:fadeDown 0.5s ease;
    }
  </style>
</head>

<body>

  <!-- Yl√§osan teemanvaihtaja -->
  <div class="topbar">
    <button id="themeToggle" class="toggle">üåô / ‚òÄÔ∏è</button>
  </div>

  <h1>üèí Roosan veikkaukset</h1>

  <div class="card" id="cardCapture">
    <div class="person-title">Roosa</div>
    <div id="cardArea" class="kv"></div>

    <div class="row-end">
      <button id="resetBtn" class="btn btn-red">Tyhjenn√§ lomake</button>
      <button id="shareToTeroBtn" class="btn btn-green">L√§het√§ Terolle</button>
    </div>

    <p class="muted">Tiedot tallentuvat t√§h√§n laitteeseen (localStorage).</p>
  </div>

<script>
/* ---------- Teema ---------- */
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
const THEME_KEY = 'roosa_theme';

function applyTheme(mode){
  if(!mode || mode==='auto'){
    document.documentElement.removeAttribute('data-theme');
    if(prefersDark.matches){
      document.documentElement.setAttribute('data-theme','dark');
    }
  }else{
    document.documentElement.setAttribute('data-theme', mode);
  }
  localStorage.setItem(THEME_KEY, mode || 'auto');
}

applyTheme(localStorage.getItem(THEME_KEY)||'auto');

prefersDark.addEventListener?.('change',()=>applyTheme(localStorage.getItem(THEME_KEY)||'auto'));

document.getElementById('themeToggle').addEventListener('click',()=>{
  const cur = localStorage.getItem(THEME_KEY)||'auto';
  const next = cur==='auto' ? (document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark')
              : (cur==='dark'?'light':'auto');
  applyTheme(next);
});
</script>

<script>
/* ---------- Lomake ---------- */
const FIELDS=[
  {key:'lopputulos',label:'Lopputulos'},
  {key:'ekan_maalintekija',label:'Ekan maalintekij√§'},
  {key:'ekan_maali_aika',label:'Ekan maalin tekoaika'},
  {key:'ekan_jahyn_saaja',label:'Ekan j√§√§hyn saaja'},
  {key:'ekan_jahyn_syy',label:'Ekan j√§√§hyn syy'},
  {key:'montako_jahyja',label:'Montako j√§√§hy√§'},
  {key:'parempi_laukasu',label:'Kummalla parempi laukaus%'},
  {key:'parempi_alotus',label:'Kummalla parempi aloitus%'},
  {key:'parempi_torjunta',label:'Kummalla parempi torjunta%'},
  {key:'parempi_alivoima',label:'Kummalla parempi alivoima%'},
  {key:'parempi_ylivoima',label:'Kummalla parempi ylivoima%'},
  {key:'era1',label:'1. er√§ tulos'},
  {key:'era2',label:'2. er√§ tulos'},
  {key:'valmentaja_haasto',label:'Valmentaja haasto'},
  {key:'maali_tyhjiin',label:'Maali tyhjiin'}
];

const ONE_X_TWO=new Set(['parempi_laukasu','parempi_alotus','parempi_torjunta','parempi_alivoima','parempi_ylivoima','era1','era2']);
const KYLLAEI=new Set(['valmentaja_haasto','maali_tyhjiin']);
const NUMK=new Set(['montako_jahyja']);

const STORAGE_KEY='turnausveikkaus_single_roosa';
let data=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(data)); }

function nScore(a,b){
  const A=(a||'').toString().trim(),B=(b||'').toString().trim();
  if(A===''&&B==='')return'';
  return (A||'0')+'-'+(B||'0');
}

function pScore(s){
  const m=(s||'').match(/^(\d+)\s*[-‚Äì]\s*(\d+)$/);
  return m?[m[1],m[2]]:['',''];
}

function pTime(s){
  const m=(s||'').match(/^(\d{1,2}):(\d{2})$/);
  return m?[m[1].padStart(2,'0'),m[2]]:['',''];
}

function wHTML(k,v){
  if(k==='lopputulos'){
    const ab=pScore(v);
    return '<div class="score-combo"><input type="number" class="goalA" value="'+ab[0]+'"/><span class="dash">-</span><input type="number" class="goalB" value="'+ab[1]+'"/></div>';
  }
  if(k==='ekan_maali_aika'){
    const t=pTime(v);
    return '<div class="time-combo"><input type="number" class="timeM" value="'+t[0]+'"/><span class="colon">:</span><input type="number" class="timeS" value="'+t[1]+'"/></div>';
  }
  if(ONE_X_TWO.has(k)){
    return `<select>
      <option ${v===''?'selected':''}></option>
      <option ${v==='1'?'selected':''}>1</option>
      <option ${v==='X'?'selected':''}>X</option>
      <option ${v==='2'?'selected':''}>2</option>
    </select>`;
  }
  if(KYLLAEI.has(k)){
    return `<select>
      <option ${v===''?'selected':''}></option>
      <option ${v==='Kyll√§'?'selected':''}>Kyll√§</option>
      <option ${v==='Ei'?'selected':''}>Ei</option>
    </select>`;
  }
  if(NUMK.has(k)){
    return '<input type="number" value="'+(v||'')+'">';
  }
  return '<input type="text" value="'+(v||'')+'">';
}

function render(){
  const wrap=document.getElementById('cardArea');
  wrap.innerHTML=FIELDS.map(
    f=>`<div class="kv-row"><div class="kv-label">${f.label}</div>${wHTML(f.key,data[f.key]||'')}</div>`
  ).join('');

  wrap.querySelectorAll('.goalA,.goalB').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const row=inp.closest('.score-combo');
      const A=row.querySelector('.goalA').value;
      const B=row.querySelector('.goalB').value;
      data.lopputulos=nScore(A,B);
      save();
    });
  });

  wrap.querySelectorAll('.timeM,.timeS').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const row=inp.closest('.time-combo');
      const M=row.querySelector('.timeM').value.padStart(2,'0');
      const S=row.querySelector('.timeS').value.padStart(2,'0');
      data.ekan_maali_aika=(M===''&&S==='')?'':M+':'+S;
      save();
    });
  });

  wrap.querySelectorAll('input:not(.goalA):not(.goalB):not(.timeM):not(.timeS),select')
  .forEach(inp=>{
    const label=inp.closest('.kv-row').querySelector('.kv-label').textContent;
    const field=FIELDS.find(x=>x.label===label).key;
    inp.addEventListener('input',()=>{
      data[field]=inp.value; save();
    });
  });
}

document.getElementById('resetBtn').addEventListener('click',()=>{
  if(!confirm('Tyhjennet√§√§nk√∂ kaikki tiedot?'))return;
  data={}; save(); render();
});

render();
</script>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
/* ---------- L√§het√§ Terolle ---------- */
const WHATSAPP_NUMBER = "358405268017";

document.getElementById("shareToTeroBtn").addEventListener("click", async function () {
  const card = document.getElementById("cardCapture");
  const canvas = await html2canvas(card, { scale: 3, backgroundColor: null });

  canvas.toBlob(async (blob)=>{
    const file = new File([blob], "roosa_veikkaus.png", { type:"image/png" });
    const shareData = { files:[file], text:"Roosan veikkauskortti", title:"Roosa" };

    if(navigator.canShare && navigator.canShare(shareData)){
      try{ await navigator.share(shareData); return; }
      catch(e){}
    }
    const text = encodeURIComponent("Roosan veikkauskortti ‚Äì liit√§ kuva mukaan.");
    window.location.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${text}`;
    alert("Jos kuva ei siirry automaattisesti, liit√§ tallentamasi kuva WhatsAppissa mukaan.");
  }, "image/png");
});
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/roosa/sw.js");
}
</script>

</body>
</html>
