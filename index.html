<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Veikkaus</title>

  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="/roosa/manifest.json">
  <link rel="icon" href="/roosa/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/roosa/icons/apple-touch-icon.png">

  <style>
    :root{
      --bg:#f7f7fb; --card:#fff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --btn:#f97316; --btn-hover:#ea580c; --info:#0ea5e9;
      --green:#22c55e; --red:#ef4444;
    }
    [data-theme="dark"]{
      --bg:#0b1020; --card:#111727; --text:#e5e7eb; --muted:#9aa3b2; --border:#243047;
      --btn:#fb8a3c; --btn-hover:#ec6f17; --info:#38bdf8;
      --green:#4ade80; --red:#f87171;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0; padding:12px; background:var(--bg); color:var(--text);
      font-family:system-ui, Segoe UI, sans-serif;
    }

    h1{ text-align:center; font-size:22px; margin:8px 0 14px; }

    .topbar{
      display:flex; justify-content:flex-end; max-width:480px;
      margin:0 auto 10px; padding:0 4px;
    }
    .toggle{
      background:transparent; border:1px solid var(--border);
      padding:6px 10px; border-radius:999px; color:var(--text); font-weight:700;
      cursor:pointer;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      max-width:480px;
      width:100%;
      margin:0 auto;
    }

    .kv{
      display:grid;
      grid-template-columns:1fr;
      gap:6px;
    }

    .kv-row{
      display:grid;
      grid-template-columns:minmax(90px, 140px) 1fr;
      gap:8px;
      align-items:center;
      width:100%;
    }

    .kv-label{
      font-size:13px; font-weight:600;
      white-space:normal;
      word-break:break-word;
    }

    input, select{
      width:100%;
      padding:9px 10px;
      border:1px solid var(--border);
      border-radius:10px;
      font-size:16px;
      background:#fff;
      color:#111;
    }
    [data-theme="dark"] input,
    [data-theme="dark"] select{
      background:#0f1525; color:#e5e7eb; border-color:#2a3651;
    }

    .score-combo, .time-combo{
      display:flex; gap:6px; align-items:center;
    }
    .score-combo input, .time-combo input{
      width:56px; text-align:center;
    }
    .dash, .colon{ font-weight:800; }

    .row-end{
      display:flex; justify-content:space-between; gap:10px;
      margin-top:10px; flex-wrap:wrap;
    }

    .btn{
      padding:10px 12px;
      border:none; border-radius:10px;
      color:#fff; font-weight:700;
      cursor:pointer;
      flex:1;
      text-align:center;
    }

    .btn-green{ background:var(--green); }
    .btn-red{ background:var(--red); }
    .btn-info{ background:var(--info); }

    .muted{
      color:var(--muted); font-size:12px;
      margin-top:8px; text-align:center;
    }
  </style>
</head>

<body>

  <div class="topbar">
    <button id="themeToggle" class="toggle">üåô / ‚òÄÔ∏è</button>
  </div>

  <h1>Veikkaus</h1>

  <div class="card" id="cardCapture">
    <div id="cardArea" class="kv"></div>

    <div class="row-end">
      <button id="resetBtn" class="btn btn-red">Tyhjenn√§</button>
      <button id="shareToTeroBtn" class="btn btn-green">L√§het√§ Terolle ‚úÖ</button>
    </div>

    <p class="muted">Tiedot tallentuvat t√§h√§n laitteeseen.</p>
  </div>

  <script>
    const THEME_KEY='roosa_theme';
    const prefersDark=window.matchMedia('(prefers-color-scheme: dark)');
    function applyTheme(mode){
      if(mode==='dark'){ document.documentElement.setAttribute('data-theme','dark'); }
      else if(mode==='light'){ document.documentElement.setAttribute('data-theme','light'); }
      else{
        document.documentElement.removeAttribute('data-theme');
        if(prefersDark.matches) document.documentElement.setAttribute('data-theme','dark');
      }
      localStorage.setItem(THEME_KEY, mode);
    }
    applyTheme(localStorage.getItem(THEME_KEY)||'auto');
    document.getElementById('themeToggle').onclick=()=>{
      const m=localStorage.getItem(THEME_KEY)||'auto';
      applyTheme(m==='dark'?'light':'dark');
    };
  </script>

  <script>
    const FIELDS=[
      {key:'lopputulos',label:'Lopputulos'},
      {key:'ekan_maalintekija',label:'Ekan maalintekij√§'},
      {key:'ekan_maali_aika',label:'Ekan maalin tekoaika'},
      {key:'ekan_jahyn_saaja',label:'Ekan j√§√§hyn saaja'},
      {key:'ekan_jahyn_syy',label:'Ekan j√§√§hyn syy'},
      {key:'montako_jahyja',label:'Montako j√§√§hy√§'},
      {key:'parempi_laukasu',label:'Kummalla parempi laukaus%'},
      {key:'parempi_alotus',label:'Kummalla parempi aloitus%'},
      {key:'parempi_torjunta',label:'Kummalla parempi torjunta%'},
      {key:'parempi_alivoima',label:'Kummalla parempi alivoima%'},
      {key:'parempi_ylivoima',label:'Kummalla parempi ylivoima%'},
      {key:'era1',label:'1. er√§ tulos'},
      {key:'era2',label:'2. er√§ tulos'},
      {key:'valmentaja_haasto',label:'Valmentaja haasto'},
      {key:'maali_tyhjiin',label:'Maali tyhjiin'}
    ];

    const ONE_X_TWO=new Set(['parempi_laukasu','parempi_alotus','parempi_torjunta','parempi_alivoima','parempi_ylivoima','era1','era2']);
    const KYLLAEI=new Set(['valmentaja_haasto','maali_tyhjiin']);
    const NUMK=new Set(['montako_jahyja']);

    const STORAGE_KEY='turnausveikkaus_single_roosa';
    let data=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
    function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(data)); }

    function nScore(a,b){
      if(a===''&&b==='')return'';
      return (a||'0')+'-'+(b||'0');
    }
    function pScore(s){ const m=(s||'').match(/^(\d+)-(\d+)$/); return m?[m[1],m[2]]:['','']; }
    function pTime(s){ const m=(s||'').match(/^(\d{1,2}):(\d{2})$/); return m?[m[1],m[2]]:['','']; }

    function wHTML(k,v){
      if(k==='lopputulos'){
        const [A,B]=pScore(v);
        return `<div class="score-combo">
                  <input type="number" class="goalA" value="${A}">
                  <span class="dash">-</span>
                  <input type="number" class="goalB" value="${B}">
                </div>`;
      }
      if(k==='ekan_maali_aika'){
        const [M,S]=pTime(v);
        return `<div class="time-combo">
                  <input class="timeM" type="number" value="${M}">
                  <span class="colon">:</span>
                  <input class="timeS" type="number" value="${S}">
                </div>`;
      }
      if(ONE_X_TWO.has(k)){
        const o=['','1','X','2'];
        return `<select>${o.map(x=>`<option ${x===v?'selected':''}>${x}</option>`).join('')}</select>`;
      }
      if(KYLLAEI.has(k)){
        const o=['','Kyll√§','Ei'];
        return `<select>${o.map(x=>`<option ${x===v?'selected':''}>${x}</option>`).join('')}</select>`;
      }
      if(NUMK.has(k)){
        return `<input type="number" value="${v||''}">`;
      }
      return `<input type="text" value="${v||''}">`;
    }

    function render(){
      const wrap=document.getElementById("cardArea");
      wrap.innerHTML = FIELDS.map(f =>
        `<div class="kv-row"><div class="kv-label">${f.label}</div>${wHTML(f.key,data[f.key]||"")}</div>`
      ).join("");

      wrap.querySelectorAll('.goalA,.goalB').forEach(inp=>{
        inp.oninput=()=>{
          const row=inp.closest('.score-combo');
          data.lopputulos=nScore(row.querySelector('.goalA').value,row.querySelector('.goalB').value);
          save();
        };
      });

      wrap.querySelectorAll('.timeM,.timeS').forEach(inp=>{
        inp.oninput=()=>{
          const row=inp.closest('.time-combo');
          data.ekan_maali_aika=row.querySelector('.timeM').value+":"+row.querySelector('.timeS').value;
          save();
        };
      });

      wrap.querySelectorAll('select,input:not(.goalA):not(.goalB):not(.timeM):not(.timeS)').forEach(inp=>{
        inp.oninput=()=>{
          const field=FIELDS.find(x=>x.label===inp.closest('.kv-row').querySelector('.kv-label').textContent).key;
          data[field]=inp.value;
          save();
        };
      });
    }

    document.getElementById("resetBtn").onclick=()=>{
      if(confirm("Tyhjennet√§√§nk√∂ kaikki tiedot?")){
        data={}; save(); render();
      }
    };

    render();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const WHATSAPP_NUMBER="358405268017";

    document.getElementById("shareToTeroBtn").onclick=async()=>{
      const card=document.getElementById("cardCapture");
      const canvas=await html2canvas(card,{scale:3,backgroundColor:null});

      canvas.toBlob(async(blob)=>{
        const file=new File([blob],"veikkaus.png",{type:"image/png"});
        const shareData={ files:[file], text:"Veikkauskortti", title:"Veikkaus" };

        if(navigator.canShare && navigator.canShare(shareData)){
          await navigator.share(shareData).catch(()=>{});
          return;
        }
        window.location.href=`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent("Veikkaus ‚Äì liit√§ kuva mukaan")}`;
      });
    };
  </script>

</body>
</html>
