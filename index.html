<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üèí Roosan veikkaukset ‚Äì Kevyt</title>

  <meta name="theme-color" content="#0f172a">

  <link rel="manifest" href="/roosa/manifest.json">
  <link rel="icon" href="/roosa/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/roosa/icons/apple-touch-icon.png">

  <style>
    :root{--bg:#f7f7fb;--card:#fff;--text:#111827;--muted:#6b7280;--border:#e5e7eb}
    html,body{margin:0;padding:0}
    body{background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;line-height:1.45;padding:12px}
    h1{text-align:center;margin:0 0 10px;font-size:20px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px;max-width:520px;margin:0 auto}
    .person-title{font-weight:800;margin-bottom:8px;font-size:16px;text-align:center}
    .kv{display:grid;grid-template-columns:1fr;gap:6px}
    .kv-row{display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center}
    .kv-label{font-weight:600;font-size:13px}
    input,select{width:100%;padding:9px 10px;border:1px solid var(--border);border-radius:10px;font-size:16px;background:#fff}
    .score-combo,.time-combo{display:flex;align-items:center;gap:6px}
    .score-combo input,.time-combo input{width:56px;text-align:center}
    .dash,.colon{font-weight:800}
    .row-end{display:flex;justify-content:space-between;margin-top:10px}
    .btn{background:#f97316;color:#fff;border:none;border-radius:10px;padding:10px 12px;font-weight:700;cursor:pointer}
    .muted{color:var(--muted);font-size:12px;text-align:center;margin-top:8px}
  </style>
</head>
<body>
  <h1>üèí Roosan veikkaukset</h1>

  <div class="card" id="cardCapture">
    <div class="person-title">Roosa</div>
    <div id="cardArea" class="kv"></div>

    <div class="row-end">
      <button id="resetBtn" class="btn">Tyhjenn√§ lomake</button>
      <button id="screenshotBtn" class="btn" style="background:#0ea5e9">Ota kuva</button>
    </div>

    <p class="muted">Tiedot tallentuvat t√§h√§n laitteeseen (localStorage).</p>
  </div>

<script>
const FIELDS=[
{key:'lopputulos',label:'Lopputulos'},
{key:'ekan_maalintekija',label:'Ekan maalintekij√§'},
{key:'ekan_maali_aika',label:'Ekan maalin tekoaika'},
{key:'ekan_jahyn_saaja',label:'Ekan j√§√§hyn saaja'},
{key:'ekan_jahyn_syy',label:'Ekan j√§√§hyn syy'},
{key:'montako_jahyja',label:'Montako j√§√§hy√§'},
{key:'parempi_laukasu',label:'Kummalla parempi laukaus%'},
{key:'parempi_alotus',label:'Kummalla parempi aloitus%'},
{key:'parempi_torjunta',label:'Kummalla parempi torjunta%'},
{key:'parempi_alivoima',label:'Kummalla parempi alivoima%'},
{key:'parempi_ylivoima',label:'Kummalla parempi ylivoima%'},
{key:'era1',label:'1. er√§ tulos'},
{key:'era2',label:'2. er√§ tulos'},
{key:'valmentaja_haasto',label:'Valmentaja haasto'},
{key:'maali_tyhjiin',label:'Maali tyhjiin'}
];

const ONE_X_TWO=new Set(['parempi_laukasu','parempi_alotus','parempi_torjunta','parempi_alivoima','parempi_ylivoima','era1','era2']);
const KYLLAEI=new Set(['valmentaja_haasto','maali_tyhjiin']);
const TEXTK=new Set(['ekan_maalintekija','ekan_jahyn_saaja','ekan_jahyn_syy']);
const NUMK=new Set(['montako_jahyja']);

const STORAGE_KEY='turnausveikkaus_single_roosa';
let data=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');

function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data));}

function nScore(a,b){
  const A=(a||'').toString().trim(),B=(b||'').toString().trim();
  if(A===''&&B==='')return'';
  return (A||'0')+'-'+(B||'0');
}

function pScore(s){
  const m=(s||'').match(/^(\\d+)\\s*[-‚Äì]\\s*(\\d+)$/);
  return m?[m[1],m[2]]:['',''];
}

function pTime(s){
  const m=(s||'').match(/^(\\d{1,2}):(\\d{2})$/);
  return m?[m[1].padStart(2,'0'),m[2]]:['',''];
}

function wHTML(k,v){
  if(k==='lopputulos'){
    const ab=pScore(v);
    return '<div class="score-combo"><input type="number" class="goalA" value="'+ab[0]+'"/><span class="dash">-</span><input type="number" class="goalB" value="'+ab[1]+'"/></div>';
  }
  if(k==='ekan_maali_aika'){
    const t=pTime(v);
    return '<div class="time-combo"><input type="number" class="timeM" value="'+t[0]+'"/><span class="colon">:</span><input type="number" class="timeS" value="'+t[1]+'"/></div>';
  }
  if(ONE_X_TWO.has(k)){
    const o=['','1','X','2'];
    return '<select>'+o.map(x=>'<option '+(x===v?'selected':'')+'>'+x+'</option>').join('')+'</select>';
  }
  if(KYLLAEI.has(k)){
    const o=['','Kyll√§','Ei'];
    return '<select>'+o.map(x=>'<option '+(x===v?'selected':'')+'>'+x+'</option>').join('')+'</select>';
  }
  if(NUMK.has(k)){
    return '<input type="number" value="'+(v||'')+'">';
  }
  return '<input type="text" value="'+(v||'')+'">';
}

function render(){
  const wrap=document.getElementById('cardArea');
  wrap.innerHTML=FIELDS.map(f=>'<div class="kv-row"><div class="kv-label">'+f.label+'</div>'+wHTML(f.key,data[f.key]||'')+'</div>').join('');

  wrap.querySelectorAll('.goalA,.goalB').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const row=inp.closest('.score-combo');
      const A=row.querySelector('.goalA').value;
      const B=row.querySelector('.goalB').value;
      data.lopputulos=nScore(A,B);
      save();
    });
  });

  wrap.querySelectorAll('.timeM,.timeS').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const row=inp.closest('.time-combo');
      const M=row.querySelector('.timeM').value.padStart(2,'0');
      const S=row.querySelector('.timeS').value.padStart(2,'0');
      data.ekan_maali_aika=M+':'+S;
      save();
    });
  });

  wrap.querySelectorAll('input:not(.goalA):not(.goalB):not(.timeM):not(.timeS),select').forEach(inp=>{
    const label=inp.closest('.kv-row').querySelector('.kv-label').textContent;
    const field=FIELDS.find(x=>x.label===label).key;
    inp.addEventListener('input',()=>{
      data[field]=inp.value;
      save();
    });
  });
}

document.getElementById('resetBtn').addEventListener('click',()=>{
  if(!confirm('Tyhjennet√§√§nk√∂ kaikki t√§m√§n lomakkeen tiedot?'))return;
  data={};
  save();
  render();
});

render();
</script>

<!-- ‚úÖ html2canvas kirjasto -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<!-- ‚úÖ Screenshot-toiminto -->
<script>
document.getElementById("screenshotBtn").addEventListener("click", function () {
  const card = document.getElementById("cardCapture");

  html2canvas(card, { scale: 3 }).then(canvas => {
    const link = document.createElement("a");
    link.download = "roosa_veikkaus.png";
    link.href = canvas.toDataURL();
    link.click();
  });
});
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/roosa/sw.js");
}
</script>

</body>
</html>
