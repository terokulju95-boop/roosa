<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üèí Roosan veikkaukset ‚Äì Kevyt</title>

  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="/roosa/manifest.json">
  <link rel="icon" href="/roosa/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/roosa/icons/apple-touch-icon.png">

  <style>
    :root{
      --bg:#f7f7fb; --card:#fff; --text:#111827;
      --muted:#6b7280; --border:#e5e7eb;
      --btn-orange:#f97316; 
      --btn-orange-hover:#ea580c;
      --btn-green:#22c55e;
      --btn-green-hover:#16a34a;
      --btn-red:#ef4444;
      --btn-red-hover:#dc2626;
      --info:#0ea5e9;
    }

    /* DARK THEME */
    [data-theme="dark"]{
      --bg:#0b1020; --card:#111727; --text:#e5e7eb;
      --muted:#9aa3b2; --border:#243047;
      --btn-orange:#fb8a3c;
      --btn-orange-hover:#ec6f17;
      --btn-green:#4ade80;
      --btn-green-hover:#22c55e;
      --btn-red:#f87171;
      --btn-red-hover:#ef4444;
      --info:#38bdf8;
    }

    *{ box-sizing:border-box; transition:background-color .25s, color .25s, border-color .25s }

    body{
      background:var(--bg); color:var(--text);
      font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif;
      padding:12px;
      overflow-x:hidden;
    }

    h1{ text-align:center; font-size:20px; margin-bottom:12px }

    /* Topbar */
    .topbar{
      display:flex; justify-content:flex-end;
      max-width:520px; margin:0 auto 10px;
    }
    .toggle{
      padding:6px 12px; border-radius:999px;
      border:1px solid var(--border);
      background:transparent; color:var(--text);
      cursor:pointer; font-weight:700;
      transition:transform .2s;
    }
    .toggle:active{ transform:scale(.92) }

    /* CARD + entrance animation */
    .card{
      background:var(--card); border:1px solid var(--border);
      border-radius:12px; padding:10px;
      max-width:520px; margin:0 auto;
      animation:fadeSlide .6s ease-out;
    }
    @keyframes fadeSlide{
      from{ opacity:0; transform:translateY(20px); }
      to{ opacity:1; transform:translateY(0); }
    }

    .person-title{ font-weight:800; font-size:16px; text-align:center; margin-bottom:8px }

    .kv{ display:grid; gap:6px }
    .kv-row{ display:grid; grid-template-columns:120px 1fr; gap:8px }

    .kv-label{ font-weight:600; font-size:13px }

    /* INPUTS + glow on focus */
    input,select{
      padding:9px 10px; border-radius:10px;
      border:1px solid var(--border);
      font-size:16px; background:#fff; color:#111;
      transition:box-shadow .2s, transform .1s;
    }
    input:focus, select:focus{
      outline:none;
      box-shadow:0 0 0 2px var(--info);
    }

    [data-theme="dark"] input,[data-theme="dark"] select{
      background:#0f1525; color:#e5e7eb; border-color:#2a3651;
    }

    .score-combo,.time-combo{ display:flex; gap:6px; align-items:center }
    .score-combo input,.time-combo input{ width:56px; text-align:center }
    .dash,.colon{ font-weight:800 }

    /* Buttons + pulse + 3D press */
    .btn{
      padding:10px 12px; border-radius:10px;
      color:#fff; border:none; font-weight:700;
      cursor:pointer;
      transition:transform .15s ease, box-shadow .2s ease;
    }
    .btn:active{
      transform:scale(.94);
    }
    .btn:hover{
      filter:brightness(1.05);
    }

    .btn-green{ background:var(--btn-green); }
    .btn-green:hover{ background:var(--btn-green-hover); }

    .btn-red{ background:var(--btn-red); }
    .btn-red:hover{ background:var(--btn-red-hover); }

    .muted{ color:var(--muted); text-align:center; margin-top:8px; font-size:12px }

    /* subtle pulse on show */
    .pulse{
      animation:pulseAnim .4s ease-out;
    }
    @keyframes pulseAnim{
      0%{ transform:scale(.9); opacity:.5 }
      100%{ transform:scale(1); opacity:1 }
    }

    .row-end{
      display:flex; justify-content:space-between;
      gap:8px; margin-top:10px; flex-wrap:wrap
    }
  </style>
</head>

<body>
  <div class="topbar">
    <button id="themeToggle" class="toggle">üåô / ‚òÄÔ∏è</button>
  </div>

  <h1>üèí Roosan veikkaukset</h1>

  <div class="card" id="cardCapture">
    <div class="person-title">Roosa</div>
    <div id="cardArea" class="kv"></div>

    <div class="row-end">
      <button id="resetBtn" class="btn btn-red">Tyhjenn√§ lomake</button>
      <button id="shareToTeroBtn" class="btn btn-green pulse">L√§het√§ Terolle ‚úÖ</button>
    </div>

    <p class="muted">Tiedot tallentuvat t√§h√§n laitteeseen (localStorage).</p>
  </div>

  <!-- Theme -->
  <script>
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const THEME_KEY = 'roosa_theme';

    function applyTheme(mode){
      if(!mode || mode==='auto'){
        document.documentElement.removeAttribute('data-theme');
        if(prefersDark.matches){ document.documentElement.setAttribute('data-theme','dark'); }
      }else{
        document.documentElement.setAttribute('data-theme', mode);
      }
      localStorage.setItem(THEME_KEY, mode || 'auto');
    }

    applyTheme(localStorage.getItem(THEME_KEY)||'auto');
    prefersDark.addEventListener?.('change',()=>applyTheme(localStorage.getItem(THEME_KEY)||'auto'));

    document.getElementById('themeToggle').addEventListener('click',()=>{
      const cur = localStorage.getItem(THEME_KEY)||'auto';
      const next = cur==='auto'
        ? (document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark')
        : (cur==='dark'?'light':'auto');
      applyTheme(next);
    });
  </script>

  <!-- Form Logic -->
  <script>
    const FIELDS=[
      {key:'lopputulos',label:'Lopputulos'},
      {key:'ekan_maalintekija',label:'Ekan maalintekij√§'},
      {key:'ekan_maali_aika',label:'Ekan maalin tekoaika'},
      {key:'ekan_jahyn_saaja',label:'Ekan j√§√§hyn saaja'},
      {key:'ekan_jahyn_syy',label:'Ekan j√§√§hyn syy'},
      {key:'montako_jahyja',label:'Montako j√§√§hy√§'},
      {key:'parempi_laukasu',label:'Kummalla parempi laukaus%'},
      {key:'parempi_alotus',label:'Kummalla parempi aloitus%'},
      {key:'parempi_torjunta',label:'Kummalla parempi torjunta%'},
      {key:'parempi_alivoima',label:'Kummalla parempi alivoima%'},
      {key:'parempi_ylivoima',label:'Kummalla parempi ylivoima%'},
      {key:'era1',label:'1. er√§ tulos'},
      {key:'era2',label:'2. er√§ tulos'},
      {key:'valmentaja_haasto',label:'Valmentaja haasto'},
      {key:'maali_tyhjiin',label:'Maali tyhjiin'}
    ];

    const ONE_X_TWO=new Set(['parempi_laukasu','parempi_alotus','parempi_torjunta','parempi_alivoima','parempi_ylivoima','era1','era2']);
    const KYLLAEI=new Set(['valmentaja_haasto','maali_tyhjiin']);
    const TEXTK=new Set(['ekan_maalintekija','ekan_jahyn_saaja','ekan_jahyn_syy']);
    const NUMK=new Set(['montako_jahyja']);

    const STORAGE_KEY='turnausveikkaus_single_roosa';
    let data=JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');

    function save(){ localStorage.setItem(STORAGE_KEY,JSON.stringify(data)); }

    function nScore(a,b){
      if(a==='' && b==='') return '';
      return (a||'0')+'-'+(b||'0');
    }

    function wHTML(k,v){
      if(k==='lopputulos'){
        const [A,B]=(v||'').split('-');
        return `
          <div class="score-combo">
            <input type="number" class="goalA" value="${A||''}">
            <span class="dash">-</span>
            <input type="number" class="goalB" value="${B||''}">
          </div>`;
      }
      if(k==='ekan_maali_aika'){
        return `
          <div class="time-combo">
            <input type="number" class="timeM" value="${(v||'').split(':')[0]||''}">
            <span class="colon">:</span>
            <input type="number" class="timeS" value="${(v||'').split(':')[1]||''}">
          </div>`;
      }
      if(ONE_X_TWO.has(k)){
        return `<select>${['','1','X','2'].map(o=>`<option ${o===v?'selected':''}>${o}</option>`).join('')}</select>`;
      }
      if(KYLLAEI.has(k)){
        return `<select>${['','Kyll√§','Ei'].map(o=>`<option ${o===v?'selected':''}>${o}</option>`).join('')}</select>`;
      }
      if(NUMK.has(k)){
        return `<input type="number" value="${v||''}">`;
      }
      return `<input type="text" value="${v||''}">`;
    }

    function render(){
      const wrap=document.getElementById('cardArea');
      wrap.innerHTML = FIELDS.map(f=>`
        <div class="kv-row">
          <div class="kv-label">${f.label}</div>
          ${wHTML(f.key,data[f.key]||'')}
        </div>`).join('');

      wrap.querySelectorAll('.goalA,.goalB').forEach(inp=>{
        inp.addEventListener('input',()=>{
          const row=inp.closest('.score-combo');
          const A=row.querySelector('.goalA').value;
          const B=row.querySelector('.goalB').value;
          data.lopputulos=nScore(A,B); save();
        });
      });

      wrap.querySelectorAll('.timeM,.timeS').forEach(inp=>{
        inp.addEventListener('input',()=>{
          const row=inp.closest('.time-combo');
          const M=row.querySelector('.timeM').value.padStart(2,'0');
          const S=row.querySelector('.timeS').value.padStart(2,'0');
          data.ekan_maali_aika = (M && S)? M+':'+S : '';
          save();
        });
      });

      wrap.querySelectorAll('input:not(.goalA):not(.goalB):not(.timeM):not(.timeS),select')
          .forEach(inp=>{
            const label=inp.closest('.kv-row').querySelector('.kv-label').textContent;
            const field=FIELDS.find(x=>x.label===label).key;
            inp.addEventListener('input',()=>{
              data[field]=inp.value; save();
            });
          });
    }

    document.getElementById('resetBtn').addEventListener('click',()=>{
      if(!confirm('Tyhjennet√§√§nk√∂ kaikki tiedot?')) return;
      data={}; save(); render();
    });

    render();
  </script>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Share -->
  <script>
    const WHATSAPP_NUMBER = "358405268017";

    document.getElementById("shareToTeroBtn").addEventListener("click", async function () {
      const card=document.getElementById("cardCapture");
      const canvas = await html2canvas(card,{scale:3,backgroundColor:null});

      canvas.toBlob(async blob=>{
        const file = new File([blob], "roosa_veikkaus.png", {type:"image/png"});
        const share = { files:[file], text:"Roosan veikkauskortti", title:"Roosa" };

        if(navigator.canShare && navigator.canShare(share)){
          try{ await navigator.share(share); return; }
          catch(e){}
        }

        const msg = encodeURIComponent("Roosan veikkauskortti ‚Äì liit√§ mukaan kuva.");
        window.location.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
        alert("Jos kuva ei liity automaattisesti, liit√§ se manuaalisesti WhatsAppissa.");
      });
    });
  </script>

  <script>
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("/roosa/sw.js");
    }
  </script>

</body>
</html>
